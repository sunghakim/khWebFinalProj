<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="ItemMapper">
	
	<!-- 아이템 구매하기 -->
	<select id="selectItemList" parameterType="item" resultType="item">
      <!-- <처럼 괄호인가 비교연산자인가 고민될때 문자열로 표시 ![CDATE ] 최신순으로 아이템 정렬 
      근데 이미지 여러개있는거중에 어떻게 하나만 가져옴? -->
        <![CDATA[
          SELECT * FROM(
			SELECT ROWNUM RNUM, TB.* FROM(
			  SELECT IT.ITEM_ID, IT.ITEM_CATEGORY_ID, IT.NAME, IT.CONTENT, IT.PRICE, IM.FILE_NAME, IM.FILE_URL 
			  FROM ITEM IT JOIN IMAGE IM ON (IT.ITEM_ID = IM.REFERENCES_ID)
			  WHERE IM.ID_TYPE = 'ITEM' AND IT.ITEM_CATEGORY_ID = #{item_category_id}
			   ORDER BY ITEM_ID DESC ) TB
			)WHERE RNUM BETWEEN ((#{page_num} - 1) * 24 + 1) AND (#{page_num} * 24) 
	    ]]>
	</select>
	
	<!-- 김성하 작업 -->
	<select id="selectItemDetail" parameterType="item" resultType="item">
    SELECT * FROM ITEM WHERE ITEM_ID = #{item_id}
  	</select>
	<select id="selectItemOptionList" parameterType="itemOption" resultType="itemOption">
    SELECT * FROM ITEM_OPTION WHERE ITEM_ID = #{item_id} AND AMOUNT NOT IN ('0')
  	</select>
	<insert id="insertShoppingList" parameterType="shoppingList">
    INSERT INTO SHOPPING_LIST VALUES(SHOPPING_LIST_SEQ.NEXTVAL, #{account_id}, #{item_id}, #{amount}, #{item_option_id})
  	</insert>
  	
	<select id="selectQuestionList" parameterType="question" resultType="question">
    SELECT * FROM QUESTION WHERE ITEM_ID = #{item_id} ORDER BY QUESTION_DATE
  	</select>
	<select id="selectQuestion" parameterType="question" resultType="question">
    SELECT * FROM QUESTION WHERE QUESTION_ID = #{question_id}
  	</select>
  	<insert id="insertQuestion" parameterType="question">
    INSERT INTO QUESTION VALUES(QUESTION_ID_SEQ.NEXTVAL, #{item_id}, #{writer_id}, #{question_title}, #{question_content}, SYSDATE, '0', NULL, NULL, NULL)
  </insert>
	

</mapper>
