<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PostMapper">
	<!-- 선택한 게시판의 게시글 상세페이지 보여주기  -->
	<select id ="selectPostList" resultMap="com.web.mall.model.PostDTO">
	  <![CDATA[
	  	SELECT  POST_ID, WRITER_ID, BOARD_ID, TITLE
	  		, CONTENT, GOOD_NUMBER, POSTING_DATE
	  	FROM POST
	  	WHERE POST_ID = #{post_id}
	  ]]>
	</select>
	
	<!--선택한 게시판의 게시글 추가  -->
	<insert id="insertPost" parameterType="com.web.mall.model.PostDTO">
    	INSERT INTO POST VALUES(
    		POST_ID_SEQ.NEXTVAL, #{writer_id}, #{board_id}, 
    			#{title}, #{content}, 0, 0, SYSDATE) 
  	</insert>
  	
  	<!-- 선택한 게시판의 게시글 추가시 이미지 추가할때 넣기 -->
  	<!-- insert id="insertImage" parameterType="com.web.mall.model.ImageDTO">
    	INSERT INTO POST VALUES(
    		IMAGE_ID_SEQ.NEXTVAL, #{post_id} ,'POST'
    		, #{file_name}, #{file_url}) 
  	</insert -->
	
	<!-- 선택한 게시글 수정 -->
  	<update id="updatePost" parameterType="com.web.mall.model.PostDTO">
	   UPDATE POSTS SET TITLE = #{Title}, CONTENT = #{Content} 
	    WHERE POST_ID = #{post_id}
  	</update>
  	
  	<!-- 게시글 삭제 -->
  	<delete id="deletePost" parameterType="com.web.mall.model.PostDTO">
		DELETE FROM POST WHERE POST_ID = #{post_id}
	</delete>
	
	<!-- 게시글 신고 -->
	<insert id="insertReport" parameterType="com.web.mall.model.ReportDTO">
	
	</insert>
	
	<!-- 좋아요 -->
	<update id="addPostGood" parameterType="int">
		UPDATE POST SET GOOD_NUMBER = #{good_number} + 1 
		WHERE POST_ID = #{post_id}
	</update>
	
	<!-- 좋아요 한번더 누르기 -->
	<update id="addPostDislike" parameterType="int">
		UPDATE POST SET GOOD_NUMBER = #{good_number} - 1 
		WHERE POST_ID = #{post_id}
	</update>
	
	<!-- 댓글 조회 -->
	<select id="selectComments" parameterType="com.web.mall.model.CommentsDTO">
		SELECT COMMENT_ID, POST_ID, WRITER_ID, POSTING_DATE, CONTENT 
		FROM COMMENTS
		ORDER BY COMMENT_ID DESC
		WHERE POST_ID = #{post_id}
	</select>
	
	<!-- 댓글 추가 -->
	<insert id="insertComments" parameterType="com.web.mall.model.CommentsDTO">
    	INSERT INTO COMMENT(COMMENT_ID, POST_ID, WRITER_ID, POSTING_DATE, CONTENT) 
    	VALUES(COMMENT_SEQ.NEXTVAL, #{post_id}, #{writer_id}, SYSDATE, #{content})
  	</insert>
  	
  	
  	
	<!-- 댓글 수정 -->
	<update id="updateComments" parameterType="com.web.mall.model.CommentsDTO">
	    UPDATE POST
	    <trim prefix="SET" prefixOverrides=",">
	    	<if test="content != null">
	    		, CONTENT = #{content} 
	    	</if> <!-- if문이 생성될때는 set구문이 붙고 아니면 set구문 안붙음 -->
	    </trim>
	    WHERE COMMENT_ID = #{comment_id}
  	</update>
  
  	<!-- 댓글 삭제 -->
  	<delete id="deleteComments" parameterType="com.web.mall.model.CommentsDTO">
		DELETE FROM COMMENT WHERE COMMENT_ID = #{comment_id}
	</delete>
	
  	<!-- 신고 문의 -->
  	<insert id="insertReport2" parameterType="com.web.mall.model.ReportDTO"> 
    	INSERT INTO COMMENT VALUES(COMMENT_SEQ.NEXTVAL, #{writer_id}, SYSDATE, #{content})
  	</insert>
	
</mapper>