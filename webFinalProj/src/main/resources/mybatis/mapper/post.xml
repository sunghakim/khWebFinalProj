<?xml version="1.0" encoding="UTF-8"?>

<mapper namespace="PostMapper">
	<resultMap id = "PostResult" type = "PostVO"> 
		<!-- 
			글정보를 저장할 resultMap을 설정
			데이터베이스 항목명(컬럼) 불러온 항목을 저장할 클래스 내의 변수명(프로퍼티) 
		-->
		<result column="PostId"  property="POST_ID" />
		<result column="WriterId"  property="WRITER_ID" />
		<result column="BoardId"  property="BOARD_ID" />
		<result column="Title"  property="TITLE" />
		<result column="Content"  property="CONTENT" />
		<result column="PostViews"  property="POST_VIEWS" />
		<result column="GoodNumber"  property="GOOD_NUMBER" />
		<result column="PostingDate"  property="POSTING_DATE" />
	</resultMap>
	
	<resultMap id="CommentsResult" type="CommentsVO">
			<result property="CommentsId" column="COMMENT_ID" />
			<result property="PostId" column="POST_ID" />
			<result property="WriterId" column="WRITER_ID" />
			<result property="PostingDate" column="POSTING_DATE" />
			<result property="Content" column="CONTENT" />
	</resultMap>
	
	<resultMap id="ReportResult" type="ReportVO">
			<result property="ReportId" column="REPORT_ID" />
			<result property="ReportReasonId" column="REPORT_Reason_ID" />
			<result property="ReporterId" column="REPORTER_ID" />
			<result property="ReportedAccountId" column="REPORTED_ACCOUNT_ID" />
			<result property="ReportedPostId" column="REPORTED_POST_ID" />
			<result property="ReportedDate" column="REPORTED_Date" />
			<result property="Content" column="CONTENT" />
			<result property="Result" column="Result" />
			<result property="ClosedDate" column="CLOSED_DATE" />
	</resultMap>
	
	<select id ="selectPostList" parameterType="PostVO" resultMap="PostResult">
	  <![CDATA[
	  	SELECT * 
	  	FROM POST
	  	ORDER BY POST_ID DESC
	  	WHERE POST_ID = #{post_id}
	  ]]>
	</select>
	
  	<update id="updatePost" parameterType="POSTVO">
	    UPDATE POST
	    <trim prefix="SET" prefixOverrides=",">
	    	<if test="question_content != null">
	    		, CONTENT = #{post_content} 
	    	</if>
	    </trim>
	    WHERE POST_ID = #{post_id}
  	</update>
  	
  	<delete id="deletePost" parameterType="String">
		DELETE FROM POST WHERE POST_ID = #{post_id}
	</delete>
	
	<insert id="insertGood" parameterType="POSTVO">
  		INSERT INTO POST VALUES(#{good_number} + 1)
  	</insert>
	
	<insert id="insertComments" parameterType="CommentsVO">
    	INSERT INTO COMMENT VALUES(COMMENT_SEQ.NEXTVAL, #{writer_id}, SYSDATE, #{content})
  	</insert>
  	
  	<delete id="deleteComments" parameterType="CommentsVO">
		DELETE FROM COMMENT WHERE COMMENT_ID = #{comment_id}
	</delete>
	
	<update id="updateComments" parameterType="CommentsVO">
	    UPDATE POST
	    <trim prefix="SET" prefixOverrides=",">
	    	<if test="content != null">
	    		, CONTENT = #{content} 
	    	</if> <!-- if문이 생성될때는 set구문이 붙고 아니면 set구문 안붙음 -->
	    </trim>
	    WHERE COMMENT_ID = #{comment_id}
  </update>
  	<insert id="insertReport" parameterType="CommentsVO">
    	INSERT INTO COMMENT VALUES(COMMENT_SEQ.NEXTVAL, #{writer_id}, SYSDATE, #{content})
  	</insert>
	
</mapper>